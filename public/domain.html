<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Choose Your Workspace</title>
  <link rel="stylesheet" href="/css/domain.css">
  <link rel="stylesheet" href="/css/theme-toggle.css">


</head>

<body>
  <div class="theme-toggle-wrapper">
    <button class="theme-toggle" type="button" onclick="typeof toggleTheme==='function'&&toggleTheme()" title="Toggle light/dark mode" aria-label="Toggle light/dark mode">
      <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg>
      <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
    </button>
  </div>
  <div class="domain-container">
    <header class="domain-header">
      <h1>Choose Your Workspace</h1>
      <p>Select a board type optimized for your workflow</p>
    </header>

    <div class="domain-grid">
      <!-- Coding Board -->
      <div class="domain-card" data-template="coding">
        <div class="card-icon">üíª</div>
        <h2>Coding Board</h2>
        <p class="card-description">Structured, logical, interview-oriented</p>

        <div class="card-preview">
          <div class="preview-section" style="height: 20%;">
            <span>Problem Statement</span>
          </div>
          <div class="preview-row">
            <div class="preview-section" style="width: 65%; height: 45%;">
              <span>Logic / Pseudocode</span>
            </div>
            <div class="preview-section" style="width: 33%; height: 45%;">
              <span>Notes</span>
            </div>
          </div>
          <div class="preview-section" style="height: 35%;">
            <span>Code Area</span>
          </div>
        </div>

        <div class="card-features">
          <span class="feature-tag">‚úì Problem-Solution Flow</span>
          <span class="feature-tag">‚úì Monospace Code Sections</span>
          <span class="feature-tag">‚úì Interview Ready</span>
        </div>

        <button class="select-btn">Start Coding</button>
      </div>

      <!-- Medical Board -->
      <div class="domain-card" data-template="medical">
        <div class="card-icon">üè•</div>
        <h2>Medical Board</h2>
        <p class="card-description">Focused, diagram-first, observational</p>

        <div class="card-preview">
          <div class="preview-section" style="height: 70%;">
            <span>Diagram Area</span>
          </div>
          <div class="preview-section" style="height: 28%;">
            <span>Observations / Notes</span>
          </div>
        </div>

        <div class="card-features">
          <span class="feature-tag">‚úì Large Diagram Space</span>
          <span class="feature-tag">‚úì Clinical Notes</span>
          <span class="feature-tag">‚úì Visual First</span>
        </div>

        <button class="select-btn">Start Diagnosing</button>
      </div>

      <!-- Finance Board -->
      <div class="domain-card" data-template="finance">
        <div class="card-icon">üí∞</div>
        <h2>Finance & Accounting</h2>
        <p class="card-description">Analytical, tabular, decision-focused</p>

        <div class="card-preview">
          <div class="preview-row">
            <div class="preview-section" style="width: 48%; height: 60%;">
              <span>Numbers / Data</span>
            </div>
            <div class="preview-section" style="width: 48%; height: 60%;">
              <span>Calculations</span>
            </div>
          </div>
          <div class="preview-section" style="height: 38%;">
            <span>Summary / Decisions</span>
          </div>
        </div>

        <div class="card-features">
          <span class="feature-tag">‚úì Split View Analysis</span>
          <span class="feature-tag">‚úì Calculation Focus</span>
          <span class="feature-tag">‚úì Decision Summary</span>
        </div>

        <button class="select-btn">Start Analyzing</button>
      </div>

      <!-- Project Planning Board -->
      <div class="domain-card" data-template="project">
        <div class="card-icon">üìÖ</div>
        <h2>Project Planning</h2>
        <p class="card-description">Workflow-driven, Kanban style</p>

        <div class="card-preview">
          <div class="preview-row">
            <div class="preview-section" style="width: 31%; height: 100%;">
              <span>To Do</span>
            </div>
            <div class="preview-section" style="width: 31%; height: 100%;">
              <span>In Progress</span>
            </div>
            <div class="preview-section" style="width: 31%; height: 100%;">
              <span>Done</span>
            </div>
          </div>
        </div>

        <div class="card-features">
          <span class="feature-tag">‚úì Kanban Workflow</span>
          <span class="feature-tag">‚úì Task Tracking</span>
          <span class="feature-tag">‚úì Progress Visibility</span>
        </div>

        <button class="select-btn">Start Planning</button>
      </div>

      <!-- Brainstorming Board -->
      <div class="domain-card" data-template="brainstorm">
        <div class="card-icon">üí°</div>
        <h2>Brainstorming</h2>
        <p class="card-description">Open, free, creative canvas</p>

        <div class="card-preview brainstorm-preview">
          <div class="floating-element" style="top: 15%; left: 20%;">üí≠</div>
          <div class="floating-element" style="top: 40%; left: 60%;">‚ú®</div>
          <div class="floating-element" style="top: 65%; left: 35%;">üé®</div>
          <span class="unlimited-text">Unlimited Creative Space</span>
        </div>

        <div class="card-features">
          <span class="feature-tag">‚úì No Boundaries</span>
          <span class="feature-tag">‚úì Free-form Ideas</span>
          <span class="feature-tag">‚úì Total Freedom</span>
        </div>

        <button class="select-btn">Start Creating</button>
      </div>
    </div>

    <footer class="domain-footer">
      <p>Not sure? Start with <strong>Brainstorming</strong> for a blank canvas</p>
    </footer>
  </div>

  <script src="/js/theme.js"></script>
  <script>
    // Handle domain selection
    document.querySelectorAll('.domain-card').forEach(card => {
      const btn = card.querySelector('.select-btn');
      const template = card.dataset.template;

      // Add hover effect
      card.addEventListener('mouseenter', () => {
        card.style.transform = 'translateY(-8px)';
      });

      card.addEventListener('mouseleave', () => {
        card.style.transform = 'translateY(0)';
      });

      // Handle click on card or button
      const selectDomain = () => {
        // Add selection visual feedback immediately
        card.style.transform = 'scale(0.98)';
        card.style.boxShadow = '0 0 20px rgba(59, 130, 246, 0.5)';
        card.style.borderColor = '#3b82f6';
        
        const btn = card.querySelector('.select-btn');
        if (btn) {
          btn.innerText = 'Redirecting...';
          btn.style.background = '#3b82f6';
        }

        // Save selection to localStorage
        localStorage.setItem('boardTemplate', template);

        // CRITICAL FIX: Preserve currentRoom data (especially isOwner flag)
        const currentRoom = JSON.parse(localStorage.getItem('currentRoom') || '{}');
        if (currentRoom && currentRoom.id) {
          // Add template to currentRoom object
          currentRoom.templateKey = template;
          localStorage.setItem('currentRoom', JSON.stringify(currentRoom));
          console.log('[DEBUG] Preserved currentRoom with template:', currentRoom);
        }

        // Redirect to canvas after a short delay for visual feedback
        setTimeout(() => {
          window.location.href = '/canvas';
        }, 400);
      };

      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        selectDomain();
      });

      card.addEventListener('click', selectDomain);
    });
  </script>
</body>

</html>