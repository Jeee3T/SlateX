<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Whiteboard - SlateX</title>
  <link rel="stylesheet" href="/css/home.css">
  <link rel="stylesheet" href="/css/canvas.css">
  <link rel="stylesheet" href="/css/theme-toggle.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>

  <!-- Top Header Bar -->
  <header id="top-header" class="glass">
    <div class="header-left">
      <div class="brand">
        <img src="/assets/logo/title-logo.png" alt="SlateX Logo" class="logo-image" />
      </div>
      <div class="divider-v"></div>
      <div class="board-info">
        <div class="board-name-wrapper">
          <span id="board-name" title="Click to rename" spellcheck="false">Untitled Board</span>
          <span class="edit-icon" id="rename-icon">‚úèÔ∏è</span>
        </div>
        <button id="info-btn" title="Room Information" class="header-icon-btn">
          <svg viewBox="0 0 24 24" width="22" height="22" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="11" fill="black" />
            <circle cx="12" cy="7" r="1.8" fill="white" />
            <rect x="10.2" y="10.5" width="3.6" height="7.5" rx="1.8" fill="white" />
          </svg>
        </button>
        <button id="home-btn" title="Go to Home" class="header-icon-btn">üè†</button>
      </div>
    </div>

    <div class="header-right">
      <button class="theme-toggle" type="button" onclick="typeof toggleTheme==='function'&&toggleTheme()"
        title="Toggle light/dark mode" aria-label="Toggle light/dark mode">
        <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="4" />
          <path
            d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41" />
        </svg>
        <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
        </svg>
      </button>
      <div class="header-participants" title="Who's joined" id="participants-avatars">
        <span class="online-label">Who's Online</span>
        <div id="avatars-list" class="avatars-list">
          <!-- Avatars will be injected here -->
        </div>
      </div>
      <button id="ai-btn" class="header-action-btn icon-only" title="Insights Assistant">
        <svg class="header-ai-icon-cluster" viewBox="0 0 24 24" width="28" height="28" fill="none">
          <!-- Main central sparkle -->
          <path d="M12 4C12 4 13 10 19 12C13 14 12 20 12 20C12 20 11 14 5 12C11 10 12 4 12 4Z"
            fill="url(#sparkle-grad-main)" />
          <!-- Small top-left sparkle -->
          <path d="M6 3C6 3 6.5 5 8.5 6C6.5 7 6 9 6 9C6 9 5.5 7 3.5 6C5.5 5 6 3 6 3Z" fill="#a78bfa" opacity="0.8" />
          <!-- Small bottom-right sparkle -->
          <path d="M18 15C18 15 18.5 17 20.5 18C18.5 19 18 21 18 21C18 21 17.5 19 15.5 18C17.5 17 18 15 18 15Z"
            fill="#7c3aed" opacity="0.6" />
          <!-- Tiny accent dot/blob -->
          <circle cx="5" cy="18" r="1.5" fill="#a78bfa" opacity="0.4" />

          <defs>
            <linearGradient id="sparkle-grad-main" x1="5" y1="4" x2="19" y2="20" gradientUnits="userSpaceOnUse">
              <stop offset="0%" stop-color="#a78bfa" />
              <stop offset="100%" stop-color="#7c3aed" />
            </linearGradient>
          </defs>
        </svg>
      </button>
      <!-- AI Dropdown Menu -->
      <div id="ai-dropdown" class="ai-dropdown hidden">
        <button class="ai-dropdown-item" id="summarize-btn">
          <span class="ai-icon">üìù</span>
          <span>Summarize Board</span>
        </button>
      </div>
      <button id="exit-btn" class="button-exit" title="Exit Board">
        <div class="icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
            stroke-linejoin="round">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
            <polyline points="16 17 21 12 16 7" />
            <line x1="21" y1="12" x2="9" y2="12" />
          </svg>
        </div>
      </button>
      <button id="share-btn" class="button-share" title="Share Board">
        <div class="icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
            stroke-linejoin="round">
            <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8" />
            <polyline points="16 6 12 2 8 6" />
            <line x1="12" y1="2" x2="12" y2="15" />
          </svg>
        </div>
      </button>
      <div id="chat-toggle-wrapper">
        <button id="chat-toggle" class="button-chat" title="Open Chat">
          <div class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
            </svg>
          </div>
          <span id="chat-badge" class="chat-badge hidden">0</span>
        </button>
      </div>

      <!-- Participant List Panel -->
      <div id="participants-panel" class="participants-panel glass hidden">
        <div class="panel-header">
          <span>Participants</span>
          <button id="close-participants" style="background:none;border:none;cursor:pointer;font-size:18px;">√ó</button>
        </div>
        <div id="full-participant-list">
          <!-- List will be injected here -->
        </div>
      </div>
    </div>
  </header>

  <!-- Room Info Panel -->
  <div id="room-info-panel" class="settings-panel hidden glass">
    <div class="panel-header"
      style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid var(--miro-border);">
      <span style="font-weight: 700; color: var(--miro-navy);">Room Details</span>
      <button id="close-room-info"
        style="background: none; border: none; cursor: pointer; font-size: 18px; color: #666;">√ó</button>
    </div>
    <div class="panel-section">
      <label>Room ID</label>
      <div
        style="display: flex; gap: 8px; align-items: center; background: #f8f8f8; padding: 10px; border-radius: 6px; border: 1px solid #eee;">
        <span id="display-room-id"
          style="font-family: monospace; font-weight: 600; font-size: 13px; color: var(--miro-navy);">---</span>
        <button onclick="copyToClipboard('display-room-id')"
          style="background: var(--miro-blue); color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 11px; margin-left: auto;">Copy</button>
      </div>
    </div>
    <div class="panel-section">
      <label>Room Password</label>
      <div
        style="display: flex; gap: 8px; align-items: center; background: #f8f8f8; padding: 10px; border-radius: 6px; border: 1px solid #eee;">
        <span id="display-room-pass"
          style="font-family: monospace; font-weight: 600; font-size: 13px; color: var(--miro-navy);">---</span>
        <button onclick="copyToClipboard('display-room-pass')"
          style="background: var(--miro-blue); color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 11px; margin-left: auto;">Copy</button>
      </div>
    </div>
  </div>

  <div id="ai-overlay" class="ai-hidden">
    <div class="loader-wrapper">
      <img src="/assets/logo/title-logo.png" alt="SlateX"
        style="height: 64px; margin-bottom: 24px; animation: pulse-sparkle 2s infinite ease-in-out;">
      <div class="loader"></div>
    </div>
  </div>

  <div id="board-container">
    <div id="watermark">
      <img src="/assets/logo/title-logo.png" alt="SlateX Logo">
    </div>
    <canvas id="board"></canvas>
    <div id="drawer-indicator" class="glass"
      style="display:none; position:fixed; bottom: 24px; left: 50%; transform: translateX(-50%); padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; z-index: 1000; box-shadow: var(--miro-shadow);">
    </div>
  </div>

  <!-- Shapes Panel -->
  <div id="shapes-panel" class="shapes-hidden">
    <div id="shapes-header">
      <span>Shapes</span>
      <button id="shapes-close">√ó</button>
    </div>
    <div id="shapes-grid">
      <div class="shape-item" data-shape="rectangle" title="Rectangle">
        <svg viewBox="0 0 60 60">
          <rect x="10" y="15" width="40" height="30" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="circle" title="Circle">
        <svg viewBox="0 0 60 60">
          <circle cx="30" cy="30" r="20" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="triangle" title="Triangle">
        <svg viewBox="0 0 60 60">
          <polygon points="30,10 50,45 10,45" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="star" title="Star">
        <svg viewBox="0 0 60 60">
          <polygon points="30,10 37,25 52,27 41,38 44,52 30,45 16,52 19,38 8,27 23,25" fill="none" stroke="currentColor"
            stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="hexagon" title="Hexagon">
        <svg viewBox="0 0 60 60">
          <polygon points="30,10 45,20 45,40 30,50 15,40 15,20" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="pentagon" title="Pentagon">
        <svg viewBox="0 0 60 60">
          <polygon points="30,10 50,25 42,48 18,48 10,25" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="diamond" title="Diamond">
        <svg viewBox="0 0 60 60">
          <polygon points="30,10 50,30 30,50 10,30" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="arrow-right" title="Arrow Right">
        <svg viewBox="0 0 60 60">
          <path d="M10,25 L40,25 L40,15 L55,30 L40,45 L40,35 L10,35 Z" fill="none" stroke="currentColor"
            stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="arrow-left" title="Arrow Left">
        <svg viewBox="0 0 60 60">
          <path d="M50,25 L20,25 L20,15 L5,30 L20,45 L20,35 L50,35 Z" fill="none" stroke="currentColor"
            stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="arrow-up" title="Arrow Up">
        <svg viewBox="0 0 60 60">
          <path d="M25,50 L25,20 L15,20 L30,5 L45,20 L35,20 L35,50 Z" fill="none" stroke="currentColor"
            stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="arrow-down" title="Arrow Down">
        <svg viewBox="0 0 60 60">
          <path d="M25,10 L25,40 L15,40 L30,55 L45,40 L35,40 L35,10 Z" fill="none" stroke="currentColor"
            stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="ellipse" title="Ellipse">
        <svg viewBox="0 0 60 60">
          <ellipse cx="30" cy="30" rx="25" ry="15" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="heart" title="Heart">
        <svg viewBox="0 0 60 60">
          <path
            d="M30,50 C30,50 10,35 10,22 C10,15 15,10 20,10 C25,10 30,15 30,15 C30,15 35,10 40,10 C45,10 50,15 50,22 C50,35 30,50 30,50 Z"
            fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="cloud" title="Cloud">
        <svg viewBox="0 0 60 60">
          <path
            d="M45,30 C45,25 42,20 37,20 C36,15 32,12 27,12 C20,12 15,17 15,24 C10,24 7,28 7,32 C7,36 10,40 15,40 L45,40 C50,40 53,36 53,32 C53,28 50,30 45,30 Z"
            fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="trapezoid" title="Trapezoid">
        <svg viewBox="0 0 60 60">
          <polygon points="20,15 40,15 50,45 10,45" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="parallelogram" title="Parallelogram">
        <svg viewBox="0 0 60 60">
          <polygon points="15,35 35,35 45,15 25,15" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="octagon" title="Octagon">
        <svg viewBox="0 0 60 60">
          <polygon points="22,10 38,10 50,22 50,38 38,50 22,50 10,38 10,22" fill="none" stroke="currentColor"
            stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="cross" title="Cross">
        <svg viewBox="0 0 60 60">
          <path d="M25,10 L35,10 L35,25 L50,25 L50,35 L35,35 L35,50 L25,50 L25,35 L10,35 L10,25 L25,25 Z" fill="none"
            stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="rounded-rect" title="Rounded Rectangle">
        <svg viewBox="0 0 60 60">
          <rect x="10" y="15" width="40" height="30" rx="5" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="speech-bubble" title="Speech Bubble">
        <svg viewBox="0 0 60 60">
          <rect x="10" y="10" width="40" height="30" rx="5" fill="none" stroke="currentColor" stroke-width="2" />
          <path d="M25,40 L20,50 L30,40" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="lightning" title="Lightning">
        <svg viewBox="0 0 60 60">
          <polygon points="35,10 15,30 28,30 25,50 45,28 32,28" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="moon" title="Moon">
        <svg viewBox="0 0 60 60">
          <path
            d="M40,15 C35,15 30,18 27,23 C24,28 24,35 27,40 C30,45 35,48 40,48 C35,48 30,45 27,40 C24,35 24,28 27,23 C30,18 35,15 40,15 M40,10 C30,10 20,18 20,30 C20,42 30,50 40,50 C45,50 48,47 48,42 C48,37 45,35 42,35 C44,32 45,28 45,25 C45,18 43,10 40,10 Z"
            fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="cylinder" title="Cylinder">
        <svg viewBox="0 0 60 60">
          <ellipse cx="30" cy="15" rx="20" ry="8" fill="none" stroke="currentColor" stroke-width="2" />
          <path d="M10,15 L10,45 M50,15 L50,45" stroke="currentColor" stroke-width="2" />
          <ellipse cx="30" cy="45" rx="20" ry="8" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="cube" title="Cube">
        <svg viewBox="0 0 60 60">
          <path d="M20,25 L30,20 L40,25 L40,40 L30,45 L20,40 Z M30,20 L30,35 M20,25 L30,35 L40,25" fill="none"
            stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
    </div>
  </div>

  <!-- Miro-style Left Toolbar -->
  <div class="miro-toolbar glass">
    <!-- Select / Hand -->
    <div class="tool-wrapper">
      <button class="tool" id="hand" title="Select / Hand">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 9V7a5 5 0 0 1 10 0v2"></path>
          <path d="M9 9V5a3 3 0 0 1 6 0v4"></path>
          <path d="M13 9V3a3 3 0 1 1 6 0v10a6 6 0 0 1-12 0V9"></path>
          <path d="M17 9V7a3 3 0 0 1 6 0v10a10 10 0 0 1-20 0V9a3 3 0 0 1 6 0"></path>
        </svg>
      </button>
    </div>

    <div class="toolbar-divider"></div>

    <!-- Templates (Primary Switch) -->
    <div class="tool-wrapper">
      <button class="tool" id="change-board-btn" title="Change Main Board">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="3" y1="9" x2="21" y2="9"></line>
          <line x1="9" y1="21" x2="9" y2="9"></line>
        </svg>
      </button>
    </div>

    <!-- Add Sub-Board (Instance) -->
    <div class="tool-wrapper">
      <button class="tool" id="add-board-btn" title="Add Board Instance (Drag & Drop)">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <path d="M12 8v8M8 12h8"></path>
        </svg>
      </button>
    </div>

    <!-- Text -->
    <div class="tool-wrapper">
      <button class="tool" id="text" title="Text">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="4 7 4 4 20 4 20 7"></polyline>
          <line x1="9" y1="20" x2="15" y2="20"></line>
          <line x1="12" y1="4" x2="12" y2="20"></line>
        </svg>
      </button>
    </div>

    <!-- Sticky Note -->
    <div class="tool-wrapper">
      <button class="tool" id="note" title="Sticky Note">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M15.5 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-10.5L15.5 3z"></path>
          <polyline points="15 3 15 9 21 9"></polyline>
        </svg>
      </button>
    </div>

    <!-- Shapes -->
    <div class="tool-wrapper">
      <button class="tool" id="shapesBtn" title="Shapes">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3" />
          <rect x="3" y="3" width="7" height="7" rx="1" />
          <polygon points="20,3 23,8 17,8" />
        </svg>
      </button>
      <button class="tool-arrow" data-target="shapeColorMenu">‚ñæ</button>
      <div class="context-menu" id="shapeColorMenu">
        <div class="color-grid">
          <span class="color-swatch" data-shape-color="#000" style="background: #000"></span>
          <span class="color-swatch" data-shape-color="#ef4444" style="background: #ef4444"></span>
          <span class="color-swatch" data-shape-color="#3b82f6" style="background: #3b82f6"></span>
          <span class="color-swatch" data-shape-color="#22c55e" style="background: #22c55e"></span>
          <span class="color-swatch" data-shape-color="#f59e0b" style="background: #f59e0b"></span>
          <span class="color-swatch" data-shape-color="#a855f7" style="background: #a855f7"></span>
          <span class="color-swatch" data-shape-color="#ec4899" style="background: #ec4899"></span>
          <span class="color-swatch" data-shape-color="#8b5cf6" style="background: #8b5cf6"></span>
        </div>
      </div>
    </div>

    <!-- Draw / Pen -->
    <div class="tool-wrapper">
      <button class="tool active" id="drawBtn" title="Pen">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
          <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
          <path d="M2 2l1.5 1.5"></path>
          <circle cx="21" cy="21" r="2"></circle>
        </svg>
      </button>
      <button class="tool-arrow" data-target="drawMenu">‚ñæ</button>
      <div class="context-menu" id="drawMenu">
        <button data-draw="pencil" class="sub-tool" title="Pencil">‚úèÔ∏è Pencil</button>
        <button data-draw="pen" class="sub-tool active" title="Pen">‚úíÔ∏è Pen</button>
        <button data-draw="brush" class="sub-tool" title="Brush">üñåÔ∏è Brush</button>
        <div class="color-grid">
          <span class="color-swatch" data-draw-color="#000" style="background: #000"></span>
          <span class="color-swatch" data-draw-color="#ef4444" style="background: #ef4444"></span>
          <span class="color-swatch" data-draw-color="#3b82f6" style="background: #3b82f6"></span>
          <span class="color-swatch" data-draw-color="#22c55e" style="background: #22c55e"></span>
          <span class="color-swatch" data-draw-color="#f59e0b" style="background: #f59e0b"></span>
          <span class="color-swatch" data-draw-color="#a855f7" style="background: #a855f7"></span>
          <span class="color-swatch" data-draw-color="#ec4899" style="background: #ec4899"></span>
          <span class="color-swatch" data-draw-color="#8b5cf6" style="background: #8b5cf6"></span>
        </div>
      </div>
    </div>

    <!-- Eraser -->
    <div class="tool-wrapper">
      <button class="tool" id="eraser" title="Eraser">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 20H7L3 16C2 15 2 13 3 12L13 2C14 1 16 1 17 2L22 7C23 8 23 10 22 11L20 13V20Z"></path>
          <line x1="6" y1="11" x2="11" y2="16"></line>
        </svg>
      </button>
    </div>

    <div class="toolbar-divider"></div>

    <!-- History / Undo Redo -->
    <div class="tool-wrapper">
      <button class="tool" id="undoBtn" title="Undo">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="1 4 1 10 7 10"></polyline>
          <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
        </svg>
      </button>
    </div>
    <div class="tool-wrapper">
      <button class="tool" id="redoBtn" title="Redo">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="23 4 23 10 17 10"></polyline>
          <path d="M20.49 15a9 9 0 1 1-2.13-9.36L23 10"></path>
        </svg>
      </button>
    </div>

    <!-- Tools Section -->
    <div class="tool-wrapper">
      <button class="tool" id="sizeBtn" title="Stroke Size (PX)">
        <span id="btnSizeDisplay"
          style="font-size: 10px; font-weight: 800; background: var(--miro-navy); color: white; padding: 2px 4px; border-radius: 3px;">5px</span>
      </button>
    </div>

    <div class="toolbar-divider"></div>

    <!-- More Tools -->
    <div class="tool-wrapper">
      <button class="tool" id="clearAll" title="Clear All">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="3 6 5 6 21 6"></polyline>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          <line x1="10" y1="11" x2="10" y2="17"></line>
          <line x1="14" y1="11" x2="14" y2="17"></line>
        </svg>
      </button>
    </div>

    <div class="tool-wrapper">
      <button class="tool" id="download" title="Download Image">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
      </button>
    </div>
  </div>

  <!-- Dedicated Template Tray (Draggable Boards) -->
  <div id="template-tray" class="template-tray glass hidden">
    <div class="tray-header">
      <h3>Board Instances</h3>
      <button id="close-tray" class="close-btn">√ó</button>
    </div>
    <p class="tray-hint">Drag a board onto the canvas</p>
    <div id="tray-items" class="tray-items">
      <!-- Dynamically filled -->
    </div>
  </div>

  <!-- Zoom & Navigation Controls (Bottom Right) -->
  <div class="zoom-controls glass">
    <button id="zoomOut" title="Zoom Out">‚àí</button>
    <div class="zoom-divider"></div>
    <span id="zoom-level">100%</span>
    <div class="zoom-divider"></div>
    <button id="zoomIn" title="Zoom In">Ôºã</button>
    <div class="zoom-divider"></div>
    <button id="reset-view" title="Reset View">‚ü≤</button>
  </div>

  <!-- Style / Settings Panel (Contextual) -->
  <div class="settings-panel glass hidden" id="style-panel">
    <div class="panel-section">
      <label>Size</label>
      <div class="size-slider-wrapper">
        <input type="range" id="sizeSlider" min="1" max="50" value="5">
        <span id="sizeValue">5px</span>
      </div>
    </div>
    <div class="panel-section">
      <label>Color</label>
      <div class="color-grid">
        <span class="color-swatch" data-color="#000" style="background: #000"></span>
        <span class="color-swatch" data-color="#ef4444" style="background: #ef4444"></span>
        <span class="color-swatch" data-color="#3b82f6" style="background: #3b82f6"></span>
        <span class="color-swatch" data-color="#22c55e" style="background: #22c55e"></span>
        <span class="color-swatch" data-color="#f59e0b" style="background: #f59e0b"></span>
        <span class="color-swatch" data-color="#a855f7" style="background: #a855f7"></span>
        <span class="color-swatch" data-color="#ec4899" style="background: #ec4899"></span>
        <span class="color-swatch" data-color="#8b5cf6" style="background: #8b5cf6"></span>
      </div>
    </div>
  </div>

  <!-- Chat Panel -->
  <div id="chat-panel" class="chat-hidden">
    <div id="chat-header">
      <span>Chat</span>
      <button id="close-chat"
        style="background:none;border:none;cursor:pointer;font-size:20px;color:inherit;opacity:0.6;">√ó</button>
    </div>
    <div id="chat-messages"></div>
    <div id="typing-indicator" class="typing-indicator" style="display: none;">
      <span class="typing-user-logo"></span>
      <span class="typing-text"></span>
      <div class="typing-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
    <div id="mention-dropdown" class="mention-dropdown hidden"></div>
    <div id="chat-input-box">
      <button id="emoji-toggle" title="Add emoji">üòä</button>
      <input id="chat-input" placeholder="Type a message... (use @ to mention)" autocomplete="off" />
      <button id="chat-send">Send</button>
      <div id="emoji-picker" class="emoji-picker hidden">
        <div class="emoji-tabs">
          <span class="emoji-tab active" data-cat="frequent">Recently</span>
          <span class="emoji-tab" data-cat="smileys">Smileys</span>
          <span class="emoji-tab" data-cat="gestures">Hands</span>
        </div>
        <div class="emoji-grid"></div>
      </div>
    </div>
  </div>


  <!-- AI Insights Modal -->
  <div id="ai-summary-modal" class="ai-modal hidden">
    <div class="ai-modal-overlay"></div>
    <div class="ai-modal-content glassmorphism">
      <div class="ai-header">
        <div class="ai-header-left">
          <div class="ai-logo-anim">
            <svg viewBox="0 0 40 40" class="ai-sparkle">
              <path d="M20 5 L22 15 L32 17 L22 19 L20 29 L18 19 L8 17 L18 15 Z" fill="currentColor" />
              <circle cx="20" cy="20" r="4" fill="white" />
            </svg>
          </div>
          <div class="ai-title-group">
            <h3>AI Insights</h3>
            <span class="ai-subtitle">Sub-Board Intelligence</span>
          </div>
        </div>
        <div class="ai-header-actions">
          <button class="ai-action-btn"><svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor"
              stroke-width="2" fill="none">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M12 8v4l3 3"></path>
            </svg></button>
          <button id="close-ai-modal" class="ai-close-btn">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2.5" fill="none">
              <path d="M18 6L6 18M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>

      <div class="ai-body">
        <h2 class="ai-hero-text">Synthesizing visual thinking into actionable insights</h2>

        <div class="ai-controls">
          <button id="summarize-submit" class="ai-generate-btn premium-gradient">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M15 18l-6-6 6-6" />
            </svg>
            <span class="btn-text">Generate Insights</span>
          </button>

          <div class="ai-status-indicators">
            <div class="status-item">
              <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" fill="none">
                <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
              </svg>
              <span>Loading</span>
            </div>
            <div class="status-item">
              <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" fill="none">
                <path d="M9 11l3 3L22 4"></path>
                <path d="M21 12a9 9 0 1 1-9-9c4.569 0 8.32 3.42 8.941 8"></path>
              </svg>
              <span>Elevation</span>
            </div>
          </div>
        </div>

        <div id="results-divider" class="ai-divider hidden">
          <div class="divider-line"></div>
          <span class="divider-text">RESULTS DISPLAY SECTION (Collapsed until generated)</span>
          <div class="divider-glow"></div>
        </div>

        <div id="summary-container" class="ai-results-grid hidden">
          <!-- Card A: Executive Summary -->
          <div class="ai-card glass-card fade-in delay-1">
            <div class="card-tag">A. Executive Summary Card</div>
            <p id="exec-summary-text" class="card-content">The core card contains insights to evaluate and generating
              the next light.</p>
            <div class="card-progress-bar"></div>
          </div>

          <!-- Card B: Key Insights -->
          <div class="ai-card glass-card fade-in delay-2">
            <div class="card-tag">Key Insights</div>
            <ul id="key-insights-list" class="smart-bullets">
              <li><span class="bullet-arrow"></span> Smart bullets</li>
              <li><span class="bullet-dot"></span> Information markers</li>
            </ul>
          </div>

          <!-- Card C: Content Analysis (Metrics) -->
          <div class="ai-card glass-card metrics-card fade-in delay-3">
            <div class="metric-item">
              <span>Content Type</span>
              <div class="metric-dots"><span class="dot active"></span><span class="dot"></span><span
                  class="dot"></span><span class="dot"></span></div>
            </div>
            <div class="metric-item">
              <span>Complexity Level</span>
              <div class="metric-dots"><span class="dot active"></span><span class="dot active"></span><span
                  class="dot active"></span><span class="dot"></span></div>
            </div>
            <div class="metric-item">
              <span>Information Density</span>
              <div class="metric-dots"><span class="dot active"></span><span class="dot active"></span><span
                  class="dot"></span><span class="dot"></span></div>
            </div>
            <div class="metric-item">
              <span>Signal vs Noise</span>
              <div class="metric-dots"><span class="dot active"></span><span class="dot active"></span><span
                  class="dot active"></span><span class="dot active"></span></div>
            </div>
          </div>

          <!-- Card D: Insights -->
          <div class="ai-card glass-card fade-in delay-4">
            <div class="card-tag">B. Insights</div>
            <p id="insights-secondary-text" class="card-content">Outcome session analysis on balance and assets.</p>
          </div>

          <!-- Card E: Thoughts -->
          <div class="ai-card glass-card fade-in delay-5">
            <div class="card-tag">Thoughts</div>
            <div class="thought-bubbles">
              <span class="thought-icon minus">-</span>
              <span class="thought-icon pipe">|</span>
              <span class="thought-icon square">‚ñ°</span>
            </div>
          </div>

          <!-- Card F: Additional Analysis -->
          <div class="ai-card glass-card fade-in delay-6">
            <div class="card-tag">Content Analysis</div>
            <div class="analysis-icons">
              <div class="icon-block"><svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                  <circle cx="12" cy="12" r="8"></circle>
                </svg></div>
              <div class="icon-block active"><svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                  <path d="M12 2L15 8H9L12 2Z"></path>
                </svg></div>
            </div>
          </div>
        </div>

        <!-- AI Insight Chat Interface -->
        <div id="ai-chat-section" class="ai-chat-section hidden">
          <div class="chat-header">
            <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" fill="none" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <span>Ask about these insights</span>
          </div>
          <div id="ai-chat-history" class="chat-history">
            <div class="chat-bubble ai-bubble fade-in">
              Hello! I've analyzed your board. Do you have any specific questions about these insights?
            </div>
          </div>
          <div class="chat-input-wrapper">
            <input type="text" id="ai-chat-input" placeholder="Type your question here..." />
            <button id="ai-chat-send" class="chat-send-btn">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <div class="ai-footer">
        <button id="copy-summary-btn" class="ai-minimal-btn">
          <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" fill="none">
            <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
            <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
          </svg>
          <span>Copy Insights</span>
        </button>
      </div>
    </div>
  </div>

  </div>
  </div>
  </div>
  </div>


  <!-- Socket.IO client (MUST come first) -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/theme.js"></script>
  <script src="/js/board-templates.js"></script>

  <!-- Your existing whiteboard logic -->
  <script src="/js/canvas.js"></script>

  <!-- Exit button handler is now in canvas.js with save-on-exit functionality -->


  <!-- Immersive Full-Screen "Generating" Animation -->
  <div id="ai-loading-container" class="hidden">
    <div class="loader-wrapper">
      <span class="loader-letter">G</span>
      <span class="loader-letter">e</span>
      <span class="loader-letter">n</span>
      <span class="loader-letter">e</span>
      <span class="loader-letter">r</span>
      <span class="loader-letter">a</span>
      <span class="loader-letter">t</span>
      <span class="loader-letter">i</span>
      <span class="loader-letter">n</span>
      <span class="loader-letter">g</span>
      <div class="loader"></div>
    </div>
  </div>
</body>

</html>