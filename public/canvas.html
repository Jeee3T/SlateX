<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>SlateX</title>
  <link rel="icon" type="image/png" href="/assets/logo/title-logo.png">
  <link rel="stylesheet" href="/css/home.css">
  <link rel="stylesheet" href="/css/canvas.css">
  <link rel="stylesheet" href="/css/theme-toggle.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>

  <!-- Top Header Bar -->
  <header id="top-header" class="glass">
    <div class="header-left">
      <div class="brand">
        <img src="/assets/logo/title-logo.png" alt="SlateX Logo" class="logo-image" />
      </div>

      <!-- Unified Control Center Pill -->
      <div class="unified-control-center">
        <!-- Home Button Section -->
        <button id="home-btn" title="Go to Home" class="unified-btn icon-btn">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
          </svg>
        </button>

        <div class="unified-divider"></div>

        <!-- Board Name Pill Section -->
        <div class="board-name-pill" id="board-name-container">
          <span id="board-name" title="Click to rename" spellcheck="false">Untitled Board</span>
          <svg class="pencil-icon" viewBox="0 0 24 24" width="14" height="14" fill="currentColor">
            <path
              d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
          </svg>
        </div>

        <div class="unified-divider"></div>

        <!-- Info Button Section -->
        <button id="info-btn" title="Room Information" class="unified-btn icon-btn">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path
              d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z" />
          </svg>
        </button>

        <!-- Share Button Section -->
        <button id="share-btn" class="unified-share-btn" title="Share Board">
          <span>Share</span>
        </button>
      </div>
    </div>

    <div class="header-right">
      <button class="theme-toggle" type="button" onclick="typeof toggleTheme==='function'&&toggleTheme()"
        title="Toggle light/dark mode" aria-label="Toggle light/dark mode">
        <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="4" />
          <path
            d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41" />
        </svg>
        <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
        </svg>
      </button>
      <div class="header-participants" title="Who's joined" id="participants-avatars">
        <div id="avatars-list" class="avatars-list">
          <!-- Avatars will be injected here -->
        </div>
      </div>
      <button id="ai-btn" class="header-action-btn premium-ai-btn" title="Insights Assistant">
        <svg class="header-ai-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M9 3L11.23 7.77L16 10L11.23 12.23L9 17L6.77 12.23L2 10L6.77 7.77L9 3Z" />
          <path d="M17.5 13L18.61 15.39L21 16.5L18.61 17.61L17.5 20L16.39 17.61L14 16.5L16.39 15.39L17.5 13Z" />
          <path d="M17.5 2L18.4 3.91L20.31 4.81L18.4 5.71L17.5 7.62L16.6 5.71L14.69 4.81L16.6 3.91L17.5 2Z" />
        </svg>
        <span class="btn-text">Generate</span>
      </button>
      <!-- AI Dropdown Menu -->
      <div id="ai-dropdown" class="ai-dropdown hidden">
        <button class="ai-dropdown-item" id="summarize-btn">
          <span class="ai-icon">üìù</span>
          <span>Summarize Board</span>
        </button>
      </div>
      <button id="exit-btn" class="button-exit" title="Exit Board">
        <div class="icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
            stroke-linejoin="round">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
            <polyline points="16 17 21 12 16 7" />
            <line x1="21" y1="12" x2="9" y2="12" />
          </svg>
        </div>
      </button>

      <div id="chat-toggle-wrapper">
        <button id="chat-toggle" class="button-chat" title="Open Chat">
          <div class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
            </svg>
          </div>
          <span id="chat-badge" class="chat-badge hidden">0</span>
        </button>
      </div>
    </div>

    <!-- Participant List Panel -->
    <div id="participants-panel" class="participants-panel hidden glass">
      <div class="panel-header">
        <span>Participants</span>
        <button id="close-participants" class="close-btn" title="Close">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M18 6L6 18M6 6l12 12" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
        </button>
      </div>
      <div id="full-participant-list">
        <!-- List will be injected here -->
      </div>
      <div class="participants-footer">
        <span class="active-count"><span id="participant-count">0</span> participants active</span>
        <div id="mini-avatars" class="mini-avatar-stack">
          <!-- Mini avatars will be injected here -->
        </div>
      </div>
    </div>
    </div>
  </header>

  <!-- Room Info Panel -->
  <div id="room-info-panel" class="settings-panel room-info-panel hidden glass">
    <div class="panel-header">
      <h3>Room Details</h3>
      <button id="close-room-info" class="close-btn" title="Close">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M18 6L6 18M6 6l12 12" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </button>
    </div>

    <div class="panel-section">
      <div class="info-field-group">
        <label>Room ID</label>
        <div class="info-input-pill">
          <span id="display-room-id" class="info-value">---</span>
          <button class="copy-circle-btn" onclick="copyToClipboard('display-room-id')" title="Copy ID">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
              <path
                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
            </svg>
            Copy
          </button>
        </div>
      </div>

      <div class="info-field-group">
        <label>Room Password</label>
        <div class="info-input-pill">
          <span id="display-room-pass" class="info-value">---</span>
          <button class="copy-circle-btn" onclick="copyToClipboard('display-room-pass')" title="Copy Password">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
              <path
                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
            </svg>
            Copy
          </button>
        </div>
      </div>
    </div>

    <div class="panel-footer-note">
      <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
        <path
          d="M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z" />
      </svg>
      <span>Share these details to invite collaborators to your workspace.</span>
    </div>
  </div>

  <div id="ai-overlay" class="ai-hidden">
    <div class="loader-wrapper">
      <img src="/assets/logo/title-logo.png" alt="SlateX"
        style="height: 64px; margin-bottom: 24px; animation: pulse-sparkle 2s infinite ease-in-out;">
      <div class="loader"></div>
    </div>
  </div>

  <div id="board-container">
    <div id="watermark">
      <img src="/assets/logo/title-logo.png" alt="SlateX Logo">
    </div>
    <canvas id="board"></canvas>
    <div id="drawer-indicator" class="glass"
      style="display:none; position:fixed; bottom: 24px; left: 50%; transform: translateX(-50%); padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; z-index: 1000; box-shadow: var(--miro-shadow);">
    </div>
  </div>

  <!-- Shapes Panel -->
  <div id="shapes-panel" class="shapes-hidden">
    <div id="shapes-header">
      <span>Shapes</span>
      <button id="shapes-close">√ó</button>
    </div>
    <div id="shapes-grid">
      <div class="shape-item" data-shape="rectangle" title="Rectangle">
        <svg viewBox="0 0 60 60">
          <rect x="10" y="15" width="40" height="30" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="circle" title="Circle">
        <svg viewBox="0 0 60 60">
          <circle cx="30" cy="30" r="20" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="triangle" title="Triangle">
        <svg viewBox="0 0 60 60">
          <polygon points="30,10 50,45 10,45" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="star" title="Star">
        <svg viewBox="0 0 60 60">
          <polygon points="30,10 37,25 52,27 41,38 44,52 30,45 16,52 19,38 8,27 23,25" fill="none" stroke="currentColor"
            stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="hexagon" title="Hexagon">
        <svg viewBox="0 0 60 60">
          <polygon points="30,10 45,20 45,40 30,50 15,40 15,20" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="pentagon" title="Pentagon">
        <svg viewBox="0 0 60 60">
          <polygon points="30,10 50,25 42,48 18,48 10,25" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="diamond" title="Diamond">
        <svg viewBox="0 0 60 60">
          <polygon points="30,10 50,30 30,50 10,30" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="arrow-right" title="Arrow Right">
        <svg viewBox="0 0 60 60">
          <path d="M10,25 L40,25 L40,15 L55,30 L40,45 L40,35 L10,35 Z" fill="none" stroke="currentColor"
            stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="arrow-left" title="Arrow Left">
        <svg viewBox="0 0 60 60">
          <path d="M50,25 L20,25 L20,15 L5,30 L20,45 L20,35 L50,35 Z" fill="none" stroke="currentColor"
            stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="arrow-up" title="Arrow Up">
        <svg viewBox="0 0 60 60">
          <path d="M25,50 L25,20 L15,20 L30,5 L45,20 L35,20 L35,50 Z" fill="none" stroke="currentColor"
            stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="arrow-down" title="Arrow Down">
        <svg viewBox="0 0 60 60">
          <path d="M25,10 L25,40 L15,40 L30,55 L45,40 L35,40 L35,10 Z" fill="none" stroke="currentColor"
            stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="ellipse" title="Ellipse">
        <svg viewBox="0 0 60 60">
          <ellipse cx="30" cy="30" rx="25" ry="15" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="heart" title="Heart">
        <svg viewBox="0 0 60 60">
          <path
            d="M30,50 C30,50 10,35 10,22 C10,15 15,10 20,10 C25,10 30,15 30,15 C30,15 35,10 40,10 C45,10 50,15 50,22 C50,35 30,50 30,50 Z"
            fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="cloud" title="Cloud">
        <svg viewBox="0 0 60 60">
          <path
            d="M45,30 C45,25 42,20 37,20 C36,15 32,12 27,12 C20,12 15,17 15,24 C10,24 7,28 7,32 C7,36 10,40 15,40 L45,40 C50,40 53,36 53,32 C53,28 50,30 45,30 Z"
            fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="trapezoid" title="Trapezoid">
        <svg viewBox="0 0 60 60">
          <polygon points="20,15 40,15 50,45 10,45" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="parallelogram" title="Parallelogram">
        <svg viewBox="0 0 60 60">
          <polygon points="15,35 35,35 45,15 25,15" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="octagon" title="Octagon">
        <svg viewBox="0 0 60 60">
          <polygon points="22,10 38,10 50,22 50,38 38,50 22,50 10,38 10,22" fill="none" stroke="currentColor"
            stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="cross" title="Cross">
        <svg viewBox="0 0 60 60">
          <path d="M25,10 L35,10 L35,25 L50,25 L50,35 L35,35 L35,50 L25,50 L25,35 L10,35 L10,25 L25,25 Z" fill="none"
            stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="rounded-rect" title="Rounded Rectangle">
        <svg viewBox="0 0 60 60">
          <rect x="10" y="15" width="40" height="30" rx="5" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="speech-bubble" title="Speech Bubble">
        <svg viewBox="0 0 60 60">
          <rect x="10" y="10" width="40" height="30" rx="5" fill="none" stroke="currentColor" stroke-width="2" />
          <path d="M25,40 L20,50 L30,40" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="lightning" title="Lightning">
        <svg viewBox="0 0 60 60">
          <polygon points="35,10 15,30 28,30 25,50 45,28 32,28" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="moon" title="Moon">
        <svg viewBox="0 0 60 60">
          <path
            d="M40,15 C35,15 30,18 27,23 C24,28 24,35 27,40 C30,45 35,48 40,48 C35,48 30,45 27,40 C24,35 24,28 27,23 C30,18 35,15 40,15 M40,10 C30,10 20,18 20,30 C20,42 30,50 40,50 C45,50 48,47 48,42 C48,37 45,35 42,35 C44,32 45,28 45,25 C45,18 43,10 40,10 Z"
            fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="cylinder" title="Cylinder">
        <svg viewBox="0 0 60 60">
          <ellipse cx="30" cy="15" rx="20" ry="8" fill="none" stroke="currentColor" stroke-width="2" />
          <path d="M10,15 L10,45 M50,15 L50,45" stroke="currentColor" stroke-width="2" />
          <ellipse cx="30" cy="45" rx="20" ry="8" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
      <div class="shape-item" data-shape="cube" title="Cube">
        <svg viewBox="0 0 60 60">
          <path d="M20,25 L30,20 L40,25 L40,40 L30,45 L20,40 Z M30,20 L30,35 M20,25 L30,35 L40,25" fill="none"
            stroke="currentColor" stroke-width="2" />
        </svg>
      </div>
    </div>
  </div>

  <!-- Miro-style Left Toolbar -->
  <div class="miro-toolbar glass">
    <!-- Select / Hand -->
    <div class="tool-wrapper">
      <button class="tool" id="hand" title="Select / Hand">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 9V7a5 5 0 0 1 10 0v2"></path>
          <path d="M9 9V5a3 3 0 0 1 6 0v4"></path>
          <path d="M13 9V3a3 3 0 1 1 6 0v10a6 6 0 0 1-12 0V9"></path>
          <path d="M17 9V7a3 3 0 0 1 6 0v10a10 10 0 0 1-20 0V9a3 3 0 0 1 6 0"></path>
        </svg>
      </button>
    </div>

    <div class="toolbar-divider"></div>

    <!-- Templates (Primary Switch) -->
    <div class="tool-wrapper">
      <button class="tool" id="change-board-btn" title="Change Main Board">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="3" y1="9" x2="21" y2="9"></line>
          <line x1="9" y1="21" x2="9" y2="9"></line>
        </svg>
      </button>
    </div>

    <!-- Add Sub-Board (Instance) -->
    <div class="tool-wrapper">
      <button class="tool" id="add-board-btn" title="Add Board Instance (Drag & Drop)">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <path d="M12 8v8M8 12h8"></path>
        </svg>
      </button>
    </div>

    <!-- Text -->
    <div class="tool-wrapper">
      <button class="tool" id="text" title="Text">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="4 7 4 4 20 4 20 7"></polyline>
          <line x1="9" y1="20" x2="15" y2="20"></line>
          <line x1="12" y1="4" x2="12" y2="20"></line>
        </svg>
      </button>
    </div>

    <!-- Sticky Note -->
    <div class="tool-wrapper">
      <button class="tool" id="note" title="Sticky Note">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M15.5 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-10.5L15.5 3z"></path>
          <polyline points="15 3 15 9 21 9"></polyline>
        </svg>
      </button>
    </div>

    <!-- Shapes -->
    <div class="tool-wrapper">
      <button class="tool" id="shapesBtn" title="Shapes">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3" />
          <rect x="3" y="3" width="7" height="7" rx="1" />
          <polygon points="20,3 23,8 17,8" />
        </svg>
      </button>
      <button class="tool-arrow" data-target="shapeColorMenu">‚ñæ</button>
      <div class="context-menu" id="shapeColorMenu">
        <div class="color-grid">
          <span class="color-swatch" data-shape-color="#000" style="background: #000"></span>
          <span class="color-swatch" data-shape-color="#ef4444" style="background: #ef4444"></span>
          <span class="color-swatch" data-shape-color="#3b82f6" style="background: #3b82f6"></span>
          <span class="color-swatch" data-shape-color="#22c55e" style="background: #22c55e"></span>
          <span class="color-swatch" data-shape-color="#f59e0b" style="background: #f59e0b"></span>
          <span class="color-swatch" data-shape-color="#a855f7" style="background: #a855f7"></span>
          <span class="color-swatch" data-shape-color="#ec4899" style="background: #ec4899"></span>
          <span class="color-swatch" data-shape-color="#8b5cf6" style="background: #8b5cf6"></span>
        </div>
      </div>
    </div>

    <!-- Draw / Pen -->
    <div class="tool-wrapper">
      <button class="tool active" id="drawBtn" title="Pen">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
          <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
          <path d="M2 2l1.5 1.5"></path>
          <circle cx="21" cy="21" r="2"></circle>
        </svg>
      </button>
      <button class="tool-arrow" data-target="drawMenu">‚ñæ</button>
      <div class="context-menu" id="drawMenu">
        <button data-draw="pencil" class="sub-tool" title="Pencil">‚úèÔ∏è Pencil</button>
        <button data-draw="pen" class="sub-tool active" title="Pen">‚úíÔ∏è Pen</button>
        <button data-draw="brush" class="sub-tool" title="Brush">üñåÔ∏è Brush</button>
        <div class="color-grid">
          <span class="color-swatch" data-draw-color="#000" style="background: #000"></span>
          <span class="color-swatch" data-draw-color="#ef4444" style="background: #ef4444"></span>
          <span class="color-swatch" data-draw-color="#3b82f6" style="background: #3b82f6"></span>
          <span class="color-swatch" data-draw-color="#22c55e" style="background: #22c55e"></span>
          <span class="color-swatch" data-draw-color="#f59e0b" style="background: #f59e0b"></span>
          <span class="color-swatch" data-draw-color="#a855f7" style="background: #a855f7"></span>
          <span class="color-swatch" data-draw-color="#ec4899" style="background: #ec4899"></span>
          <span class="color-swatch" data-draw-color="#8b5cf6" style="background: #8b5cf6"></span>
        </div>
      </div>
    </div>

    <!-- Eraser -->
    <div class="tool-wrapper">
      <button class="tool" id="eraser" title="Eraser">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 20H7L3 16C2 15 2 13 3 12L13 2C14 1 16 1 17 2L22 7C23 8 23 10 22 11L20 13V20Z"></path>
          <line x1="6" y1="11" x2="11" y2="16"></line>
        </svg>
      </button>
    </div>

    <div class="toolbar-divider"></div>

    <!-- History / Undo Redo -->
    <div class="tool-wrapper">
      <button class="tool" id="undoBtn" title="Undo">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="1 4 1 10 7 10"></polyline>
          <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
        </svg>
      </button>
    </div>
    <div class="tool-wrapper">
      <button class="tool" id="redoBtn" title="Redo">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="23 4 23 10 17 10"></polyline>
          <path d="M20.49 15a9 9 0 1 1-2.13-9.36L23 10"></path>
        </svg>
      </button>
    </div>

    <!-- Tools Section -->
    <div class="tool-wrapper">
      <button class="tool" id="sizeBtn" title="Stroke Size (PX)">
        <span id="btnSizeDisplay"
          style="font-size: 10px; font-weight: 800; background: var(--miro-navy); color: white; padding: 2px 4px; border-radius: 3px;">5px</span>
      </button>
    </div>

    <div class="toolbar-divider"></div>

    <!-- More Tools -->
    <div class="tool-wrapper">
      <button class="tool" id="clearAll" title="Clear All">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="3 6 5 6 21 6"></polyline>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          <line x1="10" y1="11" x2="10" y2="17"></line>
          <line x1="14" y1="11" x2="14" y2="17"></line>
        </svg>
      </button>
    </div>

    <div class="tool-wrapper">
      <button class="tool" id="download" title="Download Image">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
      </button>
    </div>
  </div>

  <!-- Dedicated Template Tray (Draggable Boards) -->
  <div id="template-tray" class="template-tray glass hidden">
    <div class="tray-header">
      <h3>Board Instances</h3>
      <button id="close-tray" class="close-btn">√ó</button>
    </div>
    <p class="tray-hint">Drag a board onto the canvas</p>
    <div id="tray-items" class="tray-items">
      <!-- Dynamically filled -->
    </div>
  </div>

  <!-- Zoom & Navigation Controls (Bottom Right) -->
  <div class="zoom-controls glass">
    <button id="zoomOut" title="Zoom Out">‚àí</button>
    <div class="zoom-divider"></div>
    <span id="zoom-level">100%</span>
    <div class="zoom-divider"></div>
    <button id="zoomIn" title="Zoom In">Ôºã</button>
    <div class="zoom-divider"></div>
    <button id="reset-view" title="Reset View">‚ü≤</button>
  </div>

  <!-- Style / Settings Panel (Contextual) -->
  <div class="settings-panel glass hidden" id="style-panel">
    <div class="panel-section">
      <label>Size</label>
      <div class="size-slider-wrapper">
        <input type="range" id="sizeSlider" min="1" max="50" value="5">
        <span id="sizeValue">5px</span>
      </div>
    </div>
    <div class="panel-section">
      <label>Color</label>
      <div class="color-grid">
        <span class="color-swatch" data-color="#000" style="background: #000"></span>
        <span class="color-swatch" data-color="#ef4444" style="background: #ef4444"></span>
        <span class="color-swatch" data-color="#3b82f6" style="background: #3b82f6"></span>
        <span class="color-swatch" data-color="#22c55e" style="background: #22c55e"></span>
        <span class="color-swatch" data-color="#f59e0b" style="background: #f59e0b"></span>
        <span class="color-swatch" data-color="#a855f7" style="background: #a855f7"></span>
        <span class="color-swatch" data-color="#ec4899" style="background: #ec4899"></span>
        <span class="color-swatch" data-color="#8b5cf6" style="background: #8b5cf6"></span>
      </div>
    </div>
  </div>

  <!-- Chat Panel -->
  <div id="chat-panel" class="chat-hidden">
    <div id="chat-header">
      <span>Chat</span>
      <button id="close-chat"
        style="background:none;border:none;cursor:pointer;font-size:20px;color:inherit;opacity:0.6;">√ó</button>
    </div>
    <div id="chat-messages"></div>
    <div id="typing-indicator" class="typing-indicator" style="display: none;">
      <span class="typing-user-logo"></span>
      <span class="typing-text"></span>
      <div class="typing-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
    <div id="mention-dropdown" class="mention-dropdown hidden"></div>
    <div id="chat-input-box">
      <button id="emoji-toggle" title="Add emoji">üòä</button>
      <input id="chat-input" placeholder="Type a message... (use @ to mention)" autocomplete="off" />
      <button id="chat-send">Send</button>
      <div id="emoji-picker" class="emoji-picker hidden">
        <div class="emoji-tabs">
          <span class="emoji-tab active" data-cat="frequent">Recently</span>
          <span class="emoji-tab" data-cat="smileys">Smileys</span>
          <span class="emoji-tab" data-cat="gestures">Hands</span>
        </div>
        <div class="emoji-grid"></div>
      </div>
    </div>
    <div class="chat-footer-note">AI POWERED INTERFACE</div>
  </div>


  <!-- AI Insights Modal -->
  <div id="ai-summary-modal" class="ai-modal hidden">
    <div class="ai-modal-overlay"></div>
    <div class="ai-modal-content glassmorphism">
      <div class="ai-header">
        <div class="ai-header-left">
          <div class="ai-logo-anim">
            <svg viewBox="0 0 40 40" class="ai-sparkle">
              <path d="M20 5 L22 15 L32 17 L22 19 L20 29 L18 19 L8 17 L18 15 Z" fill="currentColor" />
              <circle cx="20" cy="20" r="4" fill="white" />
            </svg>
          </div>
          <div class="ai-title-group">
            <h3>AI Insights</h3>
            <span class="ai-subtitle">Sub-Board Intelligence</span>
          </div>
        </div>
        <div class="ai-header-actions">
          <button class="ai-action-btn"><svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor"
              stroke-width="2" fill="none">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M12 8v4l3 3"></path>
            </svg></button>
          <button id="close-ai-modal" class="ai-close-btn">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2.5" fill="none">
              <path d="M18 6L6 18M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>

      <div class="ai-body">
        <h2 class="ai-hero-text">Synthesizing visual thinking into actionable insights</h2>

        <div class="ai-controls">
          <button id="summarize-submit" class="ai-generate-btn premium-gradient">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 3L11.23 7.77L16 10L11.23 12.23L9 17L6.77 12.23L2 10L6.77 7.77L9 3Z" />
              <path d="M17.5 13L18.61 15.39L21 16.5L18.61 17.61L17.5 20L16.39 17.61L14 16.5L16.39 15.39L17.5 13Z" />
              <path d="M17.5 2L18.4 3.91L20.31 4.81L18.4 5.71L17.5 7.62L16.6 5.71L14.69 4.81L16.6 3.91L17.5 2Z" />
            </svg>
            <span class="btn-text">Generate Insights</span>
          </button>

          <div class="ai-status-indicators">
            <div class="status-item">
              <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" fill="none">
                <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
              </svg>
              <span>Loading</span>
            </div>
            <div class="status-item">
              <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" fill="none">
                <path d="M9 11l3 3L22 4"></path>
                <path d="M21 12a9 9 0 1 1-9-9c4.569 0 8.32 3.42 8.941 8"></path>
              </svg>
              <span>Elevation</span>
            </div>
          </div>
        </div>

        <div id="ai-loading-screen" class="ai-loading-screen hidden">
          <div class="loading-content">
            <div class="loading-left">
              <div class="loader-graphic">
                <div class="gear-outer">
                  <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
                    <path
                      d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1Z" />
                  </svg>
                </div>
                <h3>Synthesizing<span class="pulse-dots"><span>.</span><span>.</span><span>.</span></span></h3>
              </div>
            </div>
            <div class="loading-right">
              <div class="loading-steps">
                <div class="step-item" id="step-layout">
                  <div class="step-icon"><svg viewBox="0 0 24 24" width="16" height="16" fill="none"
                      stroke="currentColor" stroke-width="2">
                      <path d="M3 3h7v7H3zM14 3h7v7h-7zM14 14h7v7h-7zM3 14h7v7H3z" />
                    </svg></div>
                  <div class="step-details">
                    <span class="step-title">Analyzing Layout</span>
                    <span class="step-desc">Mapping spatial relationships between canvas elements</span>
                  </div>
                  <div class="step-status" id="step-layout-status">0%</div>
                </div>
                <div class="step-item muted" id="step-context">
                  <div class="step-icon"><svg viewBox="0 0 24 24" width="16" height="16" fill="none"
                      stroke="currentColor" stroke-width="2">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                      <polyline points="14 2 14 8 20 8" />
                    </svg></div>
                  <div class="step-details">
                    <span class="step-title">Extracting Context</span>
                    <span class="step-desc">Processing handwriting and sticky note metadata</span>
                  </div>
                  <div class="step-status" id="step-context-status"><svg viewBox="0 0 24 24" width="12" height="12"
                      fill="currentColor">
                      <circle cx="12" cy="12" r="2" />
                      <circle cx="19" cy="12" r="2" />
                      <circle cx="5" cy="12" r="2" />
                    </svg></div>
                </div>
                <div class="step-item muted" id="step-insights">
                  <div class="step-icon"><svg viewBox="0 0 24 24" width="16" height="16" fill="none"
                      stroke="currentColor" stroke-width="2">
                      <path
                        d="M9.663 17h4.674M12 3v1m6.364 1.364-.707.707M21 12h-1M4 12H3m3.364-7.636.707.707M2 20h20M12 17v4m0-14a5 5 0 0 0-5 5c0 4 5 6 5 6s5-2 5-6a5 5 0 0 0-5-5Z" />
                    </svg></div>
                  <div class="step-details">
                    <span class="step-title">Generating Insights</span>
                    <span class="step-desc">Synthesizing actionable bullet points from raw data</span>
                  </div>
                  <div class="step-status" id="step-insights-status"></div>
                </div>
              </div>
              <div class="loading-footer-progress">
                <div class="load-meta">
                  <span class="load-label">SYSTEM LOAD: ELEVATION</span>
                  <span class="load-status" id="ai-load-status">PROCESSING</span>
                </div>
                <div class="custom-progress-bar">
                  <div id="ai-progress-fill" class="progress-fill"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="results-divider" class="ai-divider hidden">
          <div class="divider-line"></div>
          <span class="divider-text">RESULTS DISPLAY SECTION (Collapsed until generated)</span>
          <div class="divider-glow"></div>
        </div>

        <div id="summary-container" class="ai-results-grid hidden">
          <!-- Card A: Executive Summary -->
          <div class="ai-card glass-card fade-in delay-1">
            <div class="card-tag">A. EXECUTIVE SUMMARY CARD</div>
            <p id="exec-summary-text" class="card-content">This whiteboard is currently synthesizing key abstract
              patterns. The workspace exhibits high creative entropy with continuous wavy line drawings. The content is
              forming into structured data clusters from initial noise.</p>
            <div class="card-progress-bar"></div>
          </div>

          <!-- Card B: Key Insights -->
          <div class="ai-card glass-card fade-in delay-2">
            <div class="card-tag">KEY INSIGHTS</div>
            <ul id="key-insights-list" class="smart-bullets">
              <li><span class="bullet-arrow"></span> Smart bullets</li>
              <li><span class="bullet-dot"></span> Information markers</li>
            </ul>
          </div>

          <!-- Card C: Content Analysis (Metrics) -->
          <div class="ai-card glass-card metrics-card fade-in delay-3">
            <div class="card-tag">CONTENT METRICS</div>
            <div class="metric-item">
              <span>Content Type</span>
              <div class="metric-dots"><span class="dot active"></span><span class="dot"></span><span
                  class="dot"></span><span class="dot"></span></div>
            </div>
            <div class="metric-item">
              <span>Complexity Level</span>
              <div class="metric-dots"><span class="dot active"></span><span class="dot active"></span><span
                  class="dot active"></span><span class="dot"></span></div>
            </div>
            <div class="metric-item">
              <span>Information Density</span>
              <div class="metric-dots"><span class="dot active"></span><span class="dot active"></span><span
                  class="dot"></span><span class="dot"></span></div>
            </div>
            <div class="metric-item">
              <span>Signal vs Noise</span>
              <div class="metric-dots"><span class="dot active"></span><span class="dot active"></span><span
                  class="dot active"></span><span class="dot active"></span></div>
            </div>
          </div>

          <!-- Card D: Insights -->
          <div class="ai-card glass-card fade-in delay-4">
            <div class="card-tag">B. Insights</div>
            <p id="insights-secondary-text" class="card-content">Outcome session analysis on balance and assets.</p>
          </div>

          <!-- Card E: Thoughts -->
          <div class="ai-card glass-card fade-in delay-5">
            <div class="card-tag">Thoughts</div>
            <div class="thought-bubbles">
              <span class="thought-icon minus">-</span>
              <span class="thought-icon pipe">|</span>
              <span class="thought-icon square">‚ñ°</span>
            </div>
          </div>

          <!-- Card F: Additional Analysis -->
          <div class="ai-card glass-card fade-in delay-6">
            <div class="card-tag">Content Analysis</div>
            <div class="analysis-icons">
              <div class="icon-block"><svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                  <circle cx="12" cy="12" r="8"></circle>
                </svg></div>
              <div class="icon-block active"><svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                  <path d="M12 2L15 8H9L12 2Z"></path>
                </svg></div>
            </div>
          </div>
        </div>

        <!-- AI Insight Chat Interface -->
        <div id="ai-chat-section" class="ai-chat-section hidden">
          <div class="chat-header">
            <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" fill="none" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <span>Ask about these insights</span>
          </div>
          <div id="ai-chat-history" class="chat-history">
            <div class="chat-bubble ai-bubble fade-in">
              Hello! I've analyzed your board. Do you have any specific questions about these insights?
            </div>
          </div>
          <div class="chat-input-wrapper">
            <input type="text" id="ai-chat-input" placeholder="Type your question here..." />
            <button id="ai-chat-send" class="chat-send-btn">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <div class="ai-footer">
        <button id="expand-intelligence-btn" class="ai-minimal-btn">
          <span>Expand Full Intelligence</span>
          <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" fill="none" stroke-width="2.5">
            <line x1="7" y1="17" x2="17" y2="7"></line>
            <polyline points="7 7 17 7 17 17"></polyline>
          </svg>
        </button>
      </div>
    </div>
  </div>

  </div>
  </div>
  </div>
  </div>


  <!-- Socket.IO client (MUST come first) -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/theme.js"></script>
  <script src="/js/board-templates.js"></script>

  <!-- Your existing whiteboard logic -->
  <script src="/js/canvas.js"></script>

  <!-- Exit button handler is now in canvas.js with save-on-exit functionality -->


  <!-- Immersive Full-Screen "Generating" Animation -->
  <div id="ai-loading-container" class="hidden">
    <div class="loader-wrapper">
      <span class="loader-letter">G</span>
      <span class="loader-letter">e</span>
      <span class="loader-letter">n</span>
      <span class="loader-letter">e</span>
      <span class="loader-letter">r</span>
      <span class="loader-letter">a</span>
      <span class="loader-letter">t</span>
      <span class="loader-letter">i</span>
      <span class="loader-letter">n</span>
      <span class="loader-letter">g</span>
      <div class="loader"></div>
    </div>
  </div>
</body>

</html>